pipeline {
	triggers {
		cron('*/2 * * * *')
	}
	agent {
		label 'nodejs'
	}
	stages {
		stage('check drift') {
		  steps {
			sh '''
			ls && cat samples/*
			oc diff -k samples | tee drift.txt
 			cat drift.txt
			! test -s drift.txt
			'''
		  }
		}
	}
        post {
		failure {
			archiveArtifacts artifacts: '*.txt'
			build job: 'apply/master'
		}
		success {
			sh 'echo "no drift found" > nodrift.txt'
			archiveArtifacts artifacts: 'nodrift.txt'
		}
	}
}
